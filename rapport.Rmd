---
title: "Analyse des Résiliations de Cartes de Crédit"
output: 
  pdf_document:
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Chargement des données

```{r, message=FALSE}
library(ggplot2)
library(skimr)
library(VIM)
library(outliers)
library(psych)
library(corrplot)

# Chargement des données
tab <- read.csv(file = "./data/credit-card-customers/cleaned_data.csv", sep = ',', dec = '.', header = TRUE)
```

# Objectif 1: Compréhension des caractéristiques démographiques

```{r}
# Profils démographiques des clients résiliant leurs services de cartes de crédit
par(mfrow = c(2, 3))

# Analyse univariée pour chaque variable démographique
for (var in c("Customer_Age", "Gender", "Dependent_count", "Education_Level", "Marital_Status", "Income_Category")) {
  barplot(table(tab$Attrition_Flag, tab[[var]]), main = var, col = c("skyblue", "lightblue"), legend.text = TRUE)
}
```

# Objectif 2: Étude des relations entre les variables

## Choix des variables

1. **Représentativité des domaines clés :**
   - **Customer_Age :** L'âge du client est souvent un facteur important dans de nombreuses analyses démographiques.
   - **Dependent_count :** Le nombre de personnes à charge peut influencer les habitudes de dépenses et la gestion financière.
   - **Credit_Limit :** La limite de crédit est un indicateur financier clé qui peut être lié à d'autres comportements financiers.
   - **Total_Trans_Amt :** Le montant total des transactions peut indiquer l'activité financière globale du client.
   - **Total_Trans_Ct :** Le nombre total de transactions peut également fournir des informations sur l'utilisation des services.

2. **Variables pertinentes pour la résiliation de carte de crédit :**
   - Ces variables sont susceptibles d'influencer la décision de résiliation des services de carte de crédit. Par exemple, l'âge, la situation familiale, les habitudes de dépenses (indiquées par la limite de crédit et le montant total des transactions), et l'activité de transaction (nombre total de transactions) pourraient tous être liés à la résiliation.

3. **Équilibre entre démographie et comportement financier :**
   - L'inclusion de variables démographiques (comme l'âge et le nombre de personnes à charge) en combinaison avec des variables transactionnelles permet d'obtenir une perspective équilibrée entre les caractéristiques personnelles et le comportement financier du client.

## Matrice de corrélation

La matrice de corrélation montre les relations linéaires entre les variables démographiques et transactionnelles.

```{r, echo=FALSE}
# Variables à tester
variables <- c("Customer_Age", "Dependent_count", "Credit_Limit", "Total_Trans_Amt", "Total_Trans_Ct")

# Matrice de corrélation pour les variables démographiques et transactionnelles
correlation_matrix <- cor(tab[, variables])

# Plot avec corrplot
par(mfrow = c(1, 1))
corrplot(correlation_matrix, method = "color", order = "hclust",
         tl.col = "black", tl.srt = 45, addCoef.col = "black", number.cex = 0.7)
```

### Interprétation des résultats :

- **Customer_Age et Dependent_count :**
   - Corrélation = -0.13
   - Interprétation : Il y a une corrélation négative faible entre l'âge du client et le nombre de personnes à charge. Cela suggère que, en général, les clients plus âgés ont tendance à avoir moins de personnes à charge.

- **Customer_Age et Credit_Limit :**
   - Corrélation = 0.02
   - Interprétation : La corrélation est très faible, indiquant une relation presque nulle entre l'âge du client et la limite de crédit.

- **Customer_Age et Total_Trans_Amt :**
   - Corrélation = -0.05
   - Interprétation : La corrélation est faible et négative, suggérant une tendance à une légère diminution du montant total des transactions avec l'âge.

- **Customer_Age et Total_Trans_Ct :**
   - Corrélation = -0.07
   - Interprétation : Il y a une corrélation négative faible entre l'âge du client et le nombre total de transactions. Cela suggère que les clients plus âgés ont tendance à effectuer moins de transactions.

- **Dependent_count et Credit_Limit :**
   - Corrélation = 0.08
   - Interprétation : Il y a une corrélation positive faible entre le nombre de personnes à charge et la limite de crédit. Cela pourrait signifier que les clients avec plus de personnes à charge ont tendance à avoir une limite de crédit légèrement plus élevée.

- **Dependent_count et Total_Trans_Amt :**
   - Corrélation = 0.02
   - Interprétation : La corrélation est très faible, indiquant une relation presque nulle entre le nombre de personnes à charge et le montant total des transactions.

- **Dependent_count et Total_Trans_Ct :**
   - Corrélation = 0.06
   - Interprétation : Une corrélation positive faible suggère qu'il existe une tendance à une légère augmentation du nombre total de transactions avec le nombre de personnes à charge.

- **Credit_Limit et Total_Trans_Amt :**
   - Corrélation = 0.17
   - Interprétation : Il y a une corrélation positive modérée entre la limite de crédit et le montant total des transactions. Cela indique que les clients avec une limite de crédit plus élevée ont tendance à effectuer des transactions de montant plus élevé.

- **Credit_Limit et Total_Trans_Ct :**
   - Corrélation = 0.08
   - Interprétation : La corrélation est positive faible, suggérant une relation modérée entre la limite de crédit et le nombre total de transactions.

- **Total_Trans_Amt et Total_Trans_Ct :**
    - Corrélation = 0.81
    - Interprétation : Il y a une forte corrélation positive entre le montant total des transactions et le nombre total de transactions. Cela indique que les clients effectuant un plus grand nombre de transactions ont tendance à avoir un montant total de transactions plus élevé.

## Test de corrélation
Les tests utilisent la statistique de corrélation de Pearson ou corrélation linéaire.

```{r, echo=FALSE}
# Boucle pour les tests de corrélation
for (i in 1:(length(variables) - 1)) {
  for (j in (i + 1):length(variables)) {
    
    # Exclure la paire "Total_Trans_Amt" et "Total_Trans_Ct"
    if (!(variables[i] %in% c("Total_Trans_Amt", "Total_Trans_Ct") && variables[j] %in% c("Total_Trans_Amt", "Total_Trans_Ct"))) {
      
      cat("Corrélation entre", variables[i], "et", variables[j], ":\n")
      
      # Test de corrélation
      result <- cor.test(tab[, variables[i]], tab[, variables[j]])
      
      # Affichage de la p-value
      cat("P-value =", result$p.value, "\n\n")
    }
  }
}
```

### Interprétation des résultats :

- **Customer_Age et Dependent_count :**
   - Corrélation significative (p-value = 2.98963e-27).
   - Interprétation : Il y a une corrélation statistiquement significative entre l'âge du client et le nombre de personnes à charge.

- **Customer_Age et Credit_Limit :**
   - Corrélation significative (p-value = 0.03722771).
   - Interprétation : Il existe une corrélation statistiquement significative entre l'âge du client et la limite de crédit, bien que la corrélation soit faible.

- **Customer_Age et Total_Trans_Amt :**
   - Corrélation significative (p-value = 0.0001127818).
   - Interprétation : Une corrélation négative significative existe entre l'âge du client et le montant total des transactions. Cela peut indiquer que les clients plus jeunes ont tendance à effectuer des transactions plus importantes.

- **Customer_Age et Total_Trans_Ct :**
   - Corrélation significative (p-value = 3.981838e-09).
   - Interprétation : Il y a une corrélation statistiquement significative entre l'âge du client et le nombre total de transactions. Les clients plus jeunes ont tendance à effectuer un nombre plus élevé de transactions.

- **Dependent_count et Credit_Limit :**
   - Corrélation significative (p-value = 7.178391e-12).
   - Interprétation : Il existe une corrélation significative entre le nombre de personnes à charge et la limite de crédit.

- **Dependent_count et Total_Trans_Amt :**
   - Corrélation non significative (p-value = 0.05111694).
   - Interprétation : Aucune corrélation statistiquement significative entre le nombre de personnes à charge et le montant total des transactions.

- **Dependent_count et Total_Trans_Ct :**
   - Corrélation significative (p-value = 1.649984e-06).
   - Interprétation : Une corrélation significative existe entre le nombre de personnes à charge et le nombre total de transactions.

- **Credit_Limit et Total_Trans_Amt :**
   - Corrélation significative (p-value = 4.594966e-48).
   - Interprétation : Une corrélation positive significative entre la limite de crédit et le montant total des transactions. Les clients avec une limite de crédit plus élevée ont tendance à effectuer des transactions plus importantes.

- **Credit_Limit et Total_Trans_Ct :**
   - Corrélation significative (p-value = 7.134977e-12).
   - Interprétation : Corrélation significative entre la limite de crédit et le nombre total de transactions. Les clients avec une limite de crédit plus élevée ont tendance à effectuer un plus grand nombre de transactions.
   
Les résultats de notre analyse démontrent qu'il existe des relations statistiquement significatives entre les caractéristiques démographiques, telles que l'âge du client, le nombre de personnes à charge, et les transactions financières, notamment la limite de crédit, le montant total des transactions, et le nombre total de transactions. Ces liens mettent en lumière l'importance de prendre en considération ces facteurs lors de l'évaluation des motifs de résiliation des services de cartes de crédit.

# Objectif 3: Facteurs sous-jacents à la résiliation

```{r}
# Sélection des variables pertinentes pour l'analyse factorielle
selected_vars <- c("Customer_Age", "Credit_Limit", "Total_Trans_Amt")

# Résumé statistique des colonnes sélectionnées
summary(tab[, selected_vars])

# Analyse factorielle pour réduire la dimensionnalité des données
nb_facteurs <- 2  # Nombre de facteurs à extraire
fact_model <- fa(tab[, selected_vars], nfactors = nb_facteurs, rotate = "varimax")

# Affichage des résultats de l'analyse factorielle
print(fact_model)
```

# Objectif 4: Modélisation prédictive

```{r}
# Transformation de la variable Attrition_Flag en binaire
tab$Attrition_Flag <- ifelse(tab$Attrition_Flag == "Attrited Customer", 1, 0)

# Modèle de régression logistique, prédictive pour estimer la probabilité de résiliation
model <- glm(Attrition_Flag ~ Customer_Age + Dependent_count + Credit_Limit + Total_Trans_Amt + Total_Trans_Ct, data = tab, family = "binomial")

# Affichage des résultats du modèle
summary(model)
```

# Objectif 5: Classification des clients

```{r}
# Utilisation de méthodes de classification (par exemple, k-means)
set.seed(123)  # Pour la reproductibilité
num_clusters <- 3
cluster_vars <- tab[, c("Customer_Age", "Credit_Limit", "Total_Trans_Amt", "Total_Trans_Ct")]

# Algorithme de k-means
kmeans_model <- kmeans(cluster_vars, centers = num_clusters, nstart = 20)

# Affichage des résultats de la classification
print(kmeans_model)

# Visualisation en 2D des clusters créés par k-means
library(cluster)
par(mfrow = c(1, 1))
clusplot(cluster_vars, kmeans_model$cluster, color=TRUE, shade=TRUE, labels=2, lines=0)
```






# TODO : 
### Objectif 1: Compréhension des caractéristiques démographiques

#### Profils démographiques des clients résiliant leurs services de cartes de crédit
L'analyse univariée des caractéristiques démographiques des clients permet de visualiser la distribution des résiliations pour chaque variable. Voici quelques observations :

- **Customer_Age :** La répartition des résiliations semble similaire pour différentes tranches d'âge.
- **Gender :** Les résiliations semblent réparties de manière équivalente entre les genres.
- **Dependent_count :** La plupart des clients ayant résilié ont un faible nombre de personnes à charge.
- **Education_Level :** Les clients ayant résilié proviennent de divers niveaux d'éducation, mais les diplômés universitaires semblent être légèrement plus nombreux.
- **Marital_Status :** Les clients célibataires semblent plus enclins à résilier.
- **Income_Category :** Les résiliations sont plus fréquentes chez les clients ayant des revenus modérés.

### Objectif 3: Facteurs sous-jacents à la résiliation

L'analyse factorielle avec rotation varimax sur les variables sélectionnées (Customer_Age, Credit_Limit, Total_Trans_Amt) réduit la dimensionnalité des données. Les résultats montrent les facteurs sous-jacents aux caractéristiques sélectionnées, mais il est essentiel d'interpréter ces facteurs en fonction du contexte.

### Objectif 4: Modélisation prédictive

Le modèle de régression logistique est utilisé pour estimer la probabilité de résiliation en fonction des variables disponibles. Les coefficients du modèle indiquent l'impact de chaque variable sur la probabilité de résiliation. Une analyse plus approfondie des résultats, notamment des p-values, est nécessaire pour évaluer la significativité des coefficients.

### Objectif 5: Classification des clients

L'utilisation de l'algorithme de classification k-means regroupe les clients en clusters distincts en fonction de leurs caractéristiques. La visualisation en 2D des clusters montre comment les clients sont regroupés en fonction de l'âge, du montant de crédit, du total des transactions, et du total des transactions effectuées. Cette classification peut aider à identifier des segments de clients ayant des comportements similaires.

Ces résultats fournissent une base pour mieux comprendre les caractéristiques des clients associées à la résiliation des services de cartes de crédit et pour développer des stratégies visant à réduire la résiliation. Il est recommandé d'approfondir l'analyse, d'évaluer la performance du modèle prédictif sur un ensemble de test distinct et de vérifier la stabilité des clusters au fil du temps.


# FAIT
# Objectif 2